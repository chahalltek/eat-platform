# API Map

<<<<<<< ours
This document aligns the Next.js App Router API surface with the platform domains (EAT) and the revenue-facing talent experience (ETE). Use it to find the right home for new endpoints and to keep a single inventory of what is exposed under `/api/*`.

## Route Groups and Ownership
- **Platform control plane (EAT):** `admin/*`, `tenant/*`, `feature-flags/*`, `ops/*`, `system-state/*`, `system-status/*`, `metrics/*`, `health/*`, `upload/*`. These routes enforce stricter authorization, multi-tenant safeguards, and operational controls.
- **Domain and workflow APIs (EAT core):** `jobs/*`, `candidates/*`, `job-candidate/*`, `ats/*`, `agents/*` (platform-owned runtime), `match-feedback/*`, `decision-stream/*`, `cron/*`, `metrics/*`. They back product surfaces, automation, and analytics while remaining tenant-scoped.
- **ETE-market intelligence:** `ete/*`, `match/*` (legacy agent endpoint), `network-intelligence-batch6/*`. These are oriented toward forecasts and market intelligence consumption. The long-term intent is to re-home shared utilities under platform-owned namespaces while keeping ETE-facing delivery endpoints thin.

## Where to Add New Endpoints
- **Pick the lane first.** Decide whether the new behavior is platform control, domain/workflow, or ETE delivery. Platform and domain endpoints usually belong under existing folders; ETE delivery routes should stay small and call platform primitives.
- **Prefer extending an existing route group.** If the behavior already maps to a folder above, add a new handler to that namespace instead of creating a new top-level folder. Keep ETE-specific concerns in `ete/*` until they are generalized.
- **Keep agent logic inside `agents/*`.** New automated decisioning flows should use the agent runtime pattern (`/api/agents/{agent}/run`) instead of embedding intelligence inside CRUD APIs.
- **Document the intent.** Include a short JSDoc block before the handler export describing the responsibility; the route inventory generator uses it for the summary column below.

## Route inventory (generated)

The table below is generated by `npm run docs:api-map`. Do not edit it manually.

<!-- START:route-inventory -->
| Path | Methods | Description |
| --- | --- | --- |
| /api/admin/agents/kill-switch | GET, PATCH | — |
| /api/admin/env | GET | — |
| /api/admin/ete/audit | GET | — |
| /api/admin/ete/benchmarks/releases | GET, POST | — |
| /api/admin/ete/benchmarks/releases/[releaseId] | GET | — |
| /api/admin/ete/benchmarks/releases/[releaseId]/approve | PUT | — |
| /api/admin/ete/benchmarks/releases/[releaseId]/publish | PUT | — |
| /api/admin/ete/insights | GET, POST | — |
| /api/admin/ete/insights/[id] | GET | — |
| /api/admin/ete/insights/[id]/approve | PUT | — |
| /api/admin/ete/insights/[id]/export.csv | GET | — |
| /api/admin/ete/insights/[id]/export.json | GET | — |
| /api/admin/ete/insights/[id]/export.markdown | GET | — |
| /api/admin/ete/insights/[id]/export.pdf.json | GET | — |
| /api/admin/ete/insights/[id]/publish | PUT | — |
| /api/admin/ete/seed-sample-data | POST | — |
| /api/admin/ete/tests | POST | — |
| /api/admin/mode | GET, PUT | — |
| /api/admin/quality/coverage | POST | — |
| /api/admin/tenant/[tenantId]/diagnostics | GET | — |
| /api/admin/tenant/[tenantId]/guardrails | GET, PUT | — |
| /api/admin/tenant/[tenantId]/guardrails/performance | GET | — |
| /api/admin/tenant/[tenantId]/guardrails/preview | GET | — |
| /api/admin/tenant/[tenantId]/guardrails/recommendations | GET, POST | — |
| /api/admin/tenants | GET | — |
| /api/admin/tenants/[tenantId] | GET, PATCH | — |
| /api/admin/tenants/[tenantId]/mode | GET, PATCH | — |
| /api/admin/testing | POST | — |
| /api/agents/agent/run | POST | — |
| /api/agents/explain | POST | — |
| /api/agents/failures | GET | — |
| /api/agents/intake | POST | — |
| /api/agents/match | POST | — |
| /api/agents/matcher | POST | — |
| /api/agents/outreach | POST | — |
| /api/agents/profile | POST | — |
| /api/agents/rina | POST | — |
| /api/agents/rua | POST | — |
| /api/agents/runs/[id]/retry | POST | — |
| /api/agents/shortlist | POST | — |
| /api/agents/shortlist/export | GET | — |
| /api/agents/status | GET | — |
| /api/ats/bullhorn/webhook | POST | — |
| /api/auth/login | GET, OPTIONS, POST | — |
| /api/auth/logout | OPTIONS, POST | — |
| /api/candidates | GET, POST | — |
| /api/cron/run | POST | — |
| /api/decision-stream | POST | — |
| /api/decision-stream/item | POST | — |
| /api/ete/agents/shortlist | POST | — |
| /api/ete/benchmarks/client-relative | GET | — |
| /api/ete/copilot/strategic | POST | — |
| /api/ete/forecast/time-to-fill | GET | — |
| /api/ete/l2/query | POST | — |
| /api/ete/market/signals | GET | — |
| /api/ete/outcomes | POST | — |
| /api/ete/test-plan/status | GET, POST | — |
| /api/feature-flags | GET, PATCH | — |
| /api/health | GET | — |
| /api/job-candidate/status | POST | — |
| /api/jobs/[jobReqId]/confidence | POST | — |
| /api/jobs/[jobReqId]/explain | POST | — |
| /api/jobs/[jobReqId]/matcher | POST | — |
| /api/jobs/[jobReqId]/shortlist | POST | — |
| /api/jobs/ingest | POST | — |
| /api/match | POST | — |
| /api/match-feedback | POST | — |
| /api/metrics/recruiter-behavior | POST | — |
| /api/ops/agents/status | GET | — |
| /api/system-state | GET | — |
| /api/system-status | GET | — |
| /api/tenant/access-debug/[tenantId] | GET | — |
| /api/tenant/diagnostics | GET | — |
| /api/tenant/export | POST | — |
| /api/tenant/fire_drill | POST | — |
| /api/upload/resume | POST | — |

_Generated 2025-12-14T15:02:23.725Z via `npm run docs:api-map`._

<!-- END:route-inventory -->
=======
This map documents the current `src/app/api/*` route groups and how they roll up into the platform layer versus the ETE product surfaces.
Use it as a routing index and to keep new endpoints aligned with the intended ownership boundaries.

## EAT Platform primitives
| Route group | Purpose | Representative endpoints |
| --- | --- | --- |
| `admin/*` | Control-plane surfaces for tenant management, environment toggles, and privileged testing tools. | `GET /api/admin/tenants`, `POST /api/admin/mode` |
| `auth/*` | Session lifecycle, SSO handshakes, and logout flows. | `POST /api/auth/login`, `POST /api/auth/logout` |
| `tenant/*` | Tenant-scoped diagnostics, exports, and fire-drill helpers. | `POST /api/tenant/diagnostics`, `POST /api/tenant/export` |
| `feature-flags` | Runtime flag evaluation that gates agents and experiences. | `POST /api/feature-flags` |
| `system-state` | Internal state snapshot used for health probes and operator dashboards. | `GET /api/system-state` |
| `system-status` | Redacted/public system status payload with demo-mode handling. | `GET /api/system-status` |
| `health` | Basic liveness/readiness probe. | `GET /api/health` |
| `ops/*` | Operational controls and status checks for agent runtimes. | `GET /api/ops/agents/status` |
| `cron/*` | Trigger points for scheduled jobs. | `POST /api/cron/run` |
| `upload/*` | File ingestion and parsing helpers reused across experiences. | `POST /api/upload/resume` |

## ETE experience APIs
| Route group | Purpose | Representative endpoints |
| --- | --- | --- |
| `agents/*` | Core intelligence runtimes (match, shortlist, outreach, explain, intake) with kill switches, guardrails, and usage logging. | `POST /api/agents/match`, `POST /api/agents/outreach`, `POST /api/agents/shortlist` |
| `match` | Legacy match agent entry point kept for compatibility. | `POST /api/match` |
| `match-feedback` | Feedback loop to capture recruiter signals back into the models. | `POST /api/match-feedback` |
| `decision-stream/*` | Audit stream of agent decisions with item-level fetches. | `GET /api/decision-stream`, `GET /api/decision-stream/item` |
| `ete/*` | ETE-specific analytics and outcomes surfaces. | `POST /api/ete/outcomes` |
| `ats/*` | ATS connectors and webhooks (currently Bullhorn) to ingest source-of-record changes. | `POST /api/ats/bullhorn/webhook` |
| `jobs/*` | Job ingestion and processing flows. | `POST /api/jobs/ingest` |
| `candidates` | Candidate ingestion/lookup. | `POST /api/candidates` |
| `job-candidate/*` | Lifecycle updates tying jobs and candidates together. | `POST /api/job-candidate/status` |
| `metrics/*` | Product-facing telemetry surfaces (e.g., recruiter behavior metrics). | `POST /api/metrics/recruiter-behavior` |

## How to extend
- Pick a lane first: platform primitives live under the control plane; experience APIs should sit alongside the agent or domain groups they serve.
- Keep cross-cutting concerns (authn/z, feature flags, tenancy, kill switches, usage logging) in shared middleware/libs instead of duplicating per route.
- Prefer new experience endpoints under `agents/*` (for intelligence workflows) or the relevant domain folder rather than adding more one-off legacy shims.
>>>>>>> theirs
